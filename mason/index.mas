
<%args>

@databases
$sequence => undef
$default_db => undef
$f_size => 0

</%args>


<div id="working" style="text-align: center; display:none;">
  <img src="/static/images/wheel.gif" height="30"/>
</div>


<script>
	
	var seq = ">Solyc10g047140.1.1 Receptor like kinase, RLK\nATGGATCAGTCGGTGTTGGCGATCTGGGTATTTCTCTGCTTAATTGGTCTGCTTTTCAATTTGTCACCCGTCGCCGGTAACGCTGAAGGTGATGCCTTGAATGCTCTGAAGACAAATTTGGCTGATCCTAATAGTGTTCTACAGAGTTGGGATGCAACCCTTGTTAATCCTTGTACTTGGTTCCATGTGACATGCAACAATGAAAATAGTGTGACTAGAGTTGATCTAGGAAATGCAAATCTATCAGGTCAACTGGTACCACAGCTTGGCCAACTCCAGAAATTGCAGTACTTGGAACTTTATAGTAATAACATAAGCGGAAGAATTCCAAATGAACTGGGAAACTTGACAGAGTTGGTTAGTTTGGATCTTTACCTGAACAACTTAAATGGTCCTATTCCTCCCTCATTGGGCAGGCTTCAGAAGCTACGCTTCCTGAGGCTCAATAATAACAGTTTGAATGAAGGTATTCCCATGTCTCTAACCACCATTGTTGCACTTCAAGTACTTGATCTCTCAAACAACCATTTGACAGGACTAGTTCCAGTCAACGGTTCCTTTTCACTTTTTACTCCTATAAGTTTTGCTAATAATCAGTTGGAAGTTCCTCCAGTTTCTCCACCTCCTCCTCTTCCTCCTACACCCTCATCGTCATCTTCAGTGGGCAACAGCGCAACTGGAGCTATCGCTGGAGGAGTTGCTGCAGGCGCTGCTCTTCTATTTGCAGCTCCTGCAATTTTTCTTGCTTGGTGGCGTCGGAGGAAACCACAAGACCACTTCTTTGATGTTCCTGCTGAGGAGGATCCAGAAGTTCATCTGGGACAACTCAAAAGGTTTTCCTTGCGTGAACTACAAGTTGCGTCGGATAATTTTAGCAACAGAAATATACTCGGTAGAGGTGGATTTGGTAAGGTTTATAAGGGCCGGTTAGCTGATGGCTCTTTAGTTGCAGTGAAAAGACTAAAAGAGGAACGTACTCAAGGTGGAGAGTTACAGTTCCAGACAGAAGTAGAAATGATCAGCATGGCTGTACACCGAAACCTACTTCGTTTACGGGGCTTTTGCATGACACCCACTGAGCGCGTGCTTGTTTATCCTTACATGGAGAATGGAAGTGTTGCATCACGTTTAAGAGAGAGGCCTGAATCAGAGCCCCCACTTGACTGGCCAAAAAGGAAGCGTATTGCACTTGGATCTGCAAGAGGCCTTGCTTACTTGCATGATCATTGTGATCCTAAAATTATTCATCGTGACGTCAAAGCCGCAAATATCTTGTTGGATGAGGAGTTTGAAGCAGTTGTTGGGGATTTTGGGTTAGCTAAACTCATGGACTACAAGGATACTCATGTTACCACTGCTGTACGTGGTACAATTGGGCATATTGCCCCTGAATATTTATCTACTGGTAAATCTTCTGAGAAAACTGATGTCTTTGGCTATGGGGTTATGCTTCTAGAGCTCATAACTGGGCAAAGGGCTTTTGATCTTGCTCGACTTGCGAATGATGATGATGTCATGCTGCTAGATTGGGTGAAGGGACTCCTGAAGGACAAGAAATATGAAACATTAGTTGATGCAGATCTTCAAGGTAATTACAATGAAGAAGAGGTGGAACAACTTATTCAGGTAGCTCTACTTTGCACGCAGAGTACGCCTACGGAACGTCCAAAGATGTCAGAAGTTGTAAGAATGCTTGAAGGTGATGGCCTTGCTGAGAGGTGGGAGGAATGGCAAAAGGAGGAGATGTTCCGGCAAGATTACAACCATGTACACCACCCCCATACTGATTGGATAATAGCTGACTCCACGTCAAATATCCGACCGGATGAGTTGTCAGGGCCAAGATGA\n";

	function example() { 
	    document.getElementById("sequence").value=seq;
	}
	
	function miToggle(element,statusImg,t,poller_to_control) {
		var e = $(element);
		var img = $(statusImg);

		if (e.visible()) {
			e.visualEffect('BlindUp',{duration:t});
      
      img.src = '/static/images/collapser_plus.png'
      
			if (poller_to_control){
				poller_to_control.stop();
			}
		} else {
			e.visualEffect('BlindDown',{duration:t});
      
      img.src = '/static/images/collapser_minus.png'
      
			if (poller_to_control){
				 poller_to_control.registerCallback();
				 poller_to_control.execute();
			}
		}
	 }
</script>


<center>
	<h3> SGN VIGS Tool</h3>
  
  <div id="input_collapser" style="text-align:left;width:900px;display:none">
  	<a class="collapser_link" href="javascript:miToggle('input_view','tmp_img_input',0.1,null);">
  		<img id="tmp_img_input" class="collapser_img" src="/static/images/collapser_minus.png"/>
  		<b>INPUT</b>
  	</a>
  </div>
</center>

<div id="input_view">
	<center>

  <div class="form-group">
    <label for="comment">
      Sequence:<span id="example"> (<a class="blue_text" onclick="example()" style="cursor:pointer">example sequence</a>)</span>
    </label>
    <textarea class="form-control" id="sequence" name="sequence"></textarea>
  </div>

  <div class="form-inline" >
    <div class="form-group">
      <label for="si_rna" title="siRNA selected size">n-mer size </label>
      <input type="si_rna" class="form-control" id="si_rna" value="21" name="fragment_size" style="width: 50px;">&nbsp; &nbsp; &nbsp;
    </div>
    <div class="form-group">
      <label for="f_length" title="Desired VIGS construct length">Fragment length </label>
      <input type="f_length" class="form-control" id="f_length" value="300" name="seq_fragment" style="width: 50px;">&nbsp; &nbsp; &nbsp;
    </div>
    <div class="form-group">
      <label for="mm" title="Number of mismatches allowed in Bowtie alignment">mismatches </label>
      <input type="mm" class="form-control" id="mm" value="0" name="mismatch" style="width: 50px;">&nbsp; &nbsp; &nbsp;
    </div>
  </div>

  <br />

  <div class="form-inline">
    <div class="form-group input-sm">
      <label for="bt2_db">Database &nbsp; </label>
      <select class="form-control" id='bt2_db' name="database">
    	<br />
      <%perl>
      	foreach my $d (@databases) {
      		my $db_name = $d;
      		$db_name =~ s/_/ /g;
		
      		if ($default_db) {
      			if ($d eq $default_db) {
      				print "<option id=\"default_db\" value=\"".$d."\">".$db_name."</option><br />";
      #					print "<option id=\"default_db\" value=\"".$d."\" selected=\"selected\">".$db_name."</option><br />";
      			} else {
      				print "<option value=\"".$d."\">".$db_name."</option><br />";
      			}
      		} else {
      			print "<option value=\"".$d."\">".$db_name."</option><br />";
      		}
      	}
      </%perl>
      </select>  &nbsp; <a href="http://solgenomics.net/contact/form"  title="send us an email to add other species" style="font-size:10px;"  target="_blank">Request other DBs</a>
    </div>
  </div>
	<br />
  <br />
  
  <form method="post" enctype="multipart/form-data" encoding="multipart/form-data" id="upload_expression_form" name="upload_expression_form" action="/ajax/upload_expression_file">
      <span style="cursor:default" title="Insert a expression file in a tab-delimited format">Upload Expression file: </span>
      
      <div class="input-group">
        <span class="input-group-btn">
          <input class="btn btn-default" class="form-control" type="file" name="expression_file" id="expression_file" encoding="multipart/form-data"/>
        </span>
      </div>
  </form>
  
  
	<br />
  <button type="button" class="btn btn-primary" id="upload_expression_file" value="Run VIGS Analysis">Run VIGS Analysis</button>
	<br />
	<br />
	</center>

	<center>
	<div class="subsection_bar">
		<a class="collapser_link" href="javascript:miToggle('usage_view','tmp_img_usage',0.1,null);">
      <img id="tmp_img_usage" class="sub_collapser_img" src="/static/images/collapser_plus.png"/>
			Usage Help
		</a>
	</div>

	<div id="usage_view" class="center_section" style="display:none">
      <p>
        <b>Usage:</b><br />
        1. Paste a <b>sequence</b> like in one of the examples:<br />
        <span style="background-color:#DCDCDC;">&nbsp;&nbsp;>gene_ID<br />&nbsp;&nbsp;ATGGATCAGTCGGTGTTGGCGATCT&nbsp;&nbsp;<br />&nbsp;&nbsp;ACAGCTTGGCCAACTCCAGAAATTG&nbsp;&nbsp;</span><br />
        &nbsp;&nbsp;or<br />
        <span style="background-color:#DCDCDC;">&nbsp;&nbsp;ATGGATCAGTCGGTGTTGGCGATCT&nbsp;&nbsp;</span><br />
        &nbsp;&nbsp;Or paste the <b>gene ID</b>:<br />
        <span style="background-color:#DCDCDC;">&nbsp;&nbsp;Solyc10g047140.1.1&nbsp;&nbsp;</span><br />
        2. Choose <b>n-mer size</b>, nucleotide stretch size in bp, used to identify targeted regions (18-24, Default=21)<br />
        3. Choose <b>Fragment length</b>, desired VIGS fragment length in bp (100-Sequence length, Default=300)<br />
        4. Choose <b>mismatches</b>, number of mismatches allowed in the alignment (0-2, Default=0)<br />
        <!-- 4. Choose <b>mismatches</b>, number of mismatches allowed in the alignment (0-1, Default=0)<br /> -->
        5. Choose <b>database</b><br />
        6. Upload a <b>expression values file</b> (optional), It must be a tab delimited text file, with gene identifiers in the first column and a header in the first row:
        <br/><br/>
      <span style="background-color:#DCDCDC;">
        gene_id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; expr_val p_val ...
        <br/>
        Solyc10g047140.1.1 4.56 0.0001 ...
        <br/>
        Solyc01g000020.1.1 3.64 0.0032 ...
        <br/>
        ...
      </span>
      </p>
    
	</div>
	</center>
  
</div>
	
<div id="coverage_val" val="0"></div>
<div id="seq_length" val="0"></div>
<div id="best_start" val="0"></div>
<div id="best_end" val="0"></div>
<div id="best_score" val="0"></div>
<div id="db_name" val="0"></div>
<div id="help_fsize" val="0"></div>
<div id="help_nmer" val="0"></div>
<div id="help_mm" val="0"></div>

<div id="img_height" style="display:none;" value="601"></div>

<div id="params" style="display:none;"></div>
<div id="help_dialog_tmp" style="display:none;"></div>

<div id="help_fsize"></div>
<div id="help_nmer"></div>
<div id="help_mm"></div>
<div id="help_db"></div>


<!-- ##################################################################################### -->
<!-- OUTPUT VIEW -->
<!-- ##################################################################################### -->
<br/>
<center>
<div id="res_bar" style="text-align:left;width:900px;display:none;">
	<a class="collapser_link" href="javascript:miToggle('results_section','tmp_img_res',0.1,null);">
		<img id="tmp_img_res" class="collapser_img" src="/static/images/collapser_minus.png"/>
		<b>OUTPUT</b>
	</a>
</div>

<div id="results_section" style="display:none">
	
	<br/>
	<!-- <center> -->
	<div class="subsection_bar" style="display:none;">
		<a class="collapser_link" href="javascript:miToggle('hide1','tmp_img_hide1',0.1,null);">
			<img id="tmp_img_hide1" class="sub_collapser_img" src="/static/images/collapser_minus.png"/>
			Modify Parameters
		</a>
		[<a id="help_dialog_1">Help</a>]
	</div>
	
  <div id="hide1" class="center_section" style="display:none;">
    <center>
      <div id="score_p" style="text-align:'right';"></div>
      
      <table id="mod_param_table">
        <tr>
          <td><label for="cbr_start">Region Start: &nbsp; </label><input type="text" id="cbr_start" class="form-control pull-right" style="width: 60px;"></td>
          <td><label for="cbr_end">Region End: &nbsp; </label><input type="text" id="cbr_end" class="form-control pull-right" style="width: 60px;"></td>
          <td><button type="button" id="set_custom" class="btn btn-primary" value="set custom best region">Set Custom Region</button><br /></td>
        </tr>
        <tr>
          <td><label for="t_num">Target genes: &nbsp; </label><input type="text" id="t_num" name="targets" min="1" class="form-control pull-right" style="width: 60px;"></td>
          <td><label for="f_size">Fragment size: &nbsp; </label><input type="text" id="f_size" name="seq_fragment" class="form-control pull-right" style="width: 60px;"></td>
          <td><label for="n_mer">n-mer: &nbsp; </label><input type="text" id="n_mer" name="si_rna" class="form-control pull-right" style="width: 60px;"></td>
          <td><label for="align_mm">Mismatches: &nbsp; </label><input type="text" id="align_mm" name="align_mm" class="form-control pull-right" style="width: 60px;"></td>
          <td><button id="change_par" class="btn btn-primary" type="button" value="recalculate">Change</button></td>
        </tr>
      </table>
      
      <span id="no_results" style="color:red;"></span>
      <p style="color:red" id="cbr_p"></p>
    </center>
  </div>
<br>	
	<div class="subsection_bar" style="text-align:left;width:900px;display:none;">
		<a class="collapser_link" href="javascript:miToggle('hide2','tmp_img_hide2',0.1,null);">
			<img id="tmp_img_hide2" class="sub_collapser_img" src="/static/images/collapser_minus.png"/>
			Distribution of n-mers
		</a>
		[<a id="help_dialog_2">Help</a>]
	</div>
	

		<div id="hide2" class="center_section" style="display:none;">
      <center>
		    <div class="seq_map" id="seq_map">
		         <div class="region_square" id="region_square"></div>
		     	 <canvas id="myCanvas" width="900" height="600">
		     	     Your browser does not support the HTML5 canvas
		     	 </canvas>
		    </div>
        <!-- <br /> -->
		    <button id="collapse" class="btn btn-primary" value="1">Expand Graph</button>
		    <button id="zoom" class="btn btn-primary" value="0">Zoom In</button>
		    <button id="params_dialog" class="btn btn-primary">Parameters Used</button>
				<br/>
      </center>
		</div>

	<br/>
	<div class="subsection_bar" style="text-align:left;width:900px;display:none;">
		<a class="collapser_link" href="javascript:miToggle('br_seq','tmp_img_hide3',0.1,null);">
			<img id="tmp_img_hide3" class="sub_collapser_img" src="/static/images/collapser_minus.png"/>
			Predicted Construct
		</a>
		[<a id="help_dialog_3">Help</a>]
	</div>

  <div id="br_seq" style="width:600px;">
      <p id="best_seq" style="font-family:courier;font-size:16px;text-align:left;"></p>
  </div>

	<br/>

	<div class="subsection_bar" style="text-align:left;width:900px;display:none;">
		<a class="collapser_link" href="javascript:miToggle('hide4','tmp_img_hide4',0.1,null);">
			<img id="tmp_img_hide4" class="sub_collapser_img" src="/static/images/collapser_minus.png"/>
			Sequence Overview
		</a>
		[<a id="help_dialog_4">Help</a>]
	</div>

		<div id="hide4" class="center_section" style="width:700px;">
      <center>
        <span id="query" style="display:none;text-align:left;"></span>
        <div id="markup" style="align:left;text-align:left;"></div>
      </center>
		</div>

	<br/>
	<div class="subsection_bar" style="text-align:left;width:900px;display:none;">
		<a class="collapser_link" href="javascript:miToggle('hide5','tmp_img_hide5',0.1,null);">
			<img id="tmp_img_hide5" class="sub_collapser_img" src="/static/images/collapser_minus.png"/>
			Description of matched genes
		</a>
		[<a id="help_dialog_5">Help</a>]
	</div>
	
  <div id="hide5" class="center_section">
    <center>
      <table id="target_info" class="table"></table>

      <div id="desc_dialog">
      	<table id="dialog_info" class="table"></table>
      </div>
    </center>
  </div>
	
</div>

</center>


