
<%args>

@databases
$sequence => undef
$f_size => 0

</%args>


<script>
	var seq = ">Solyc10g047140.1.1 Receptor like kinase, RLK\nATGGATCAGTCGGTGTTGGCGATCTGGGTATTTCTCTGCTTAATTGGTCTGCTTTTCAATTTGTCACCCGTCGCCGGTAACGCTGAAGGTGATGCCTTGAATGCTCTGAAGACAAATTTGGCTGATCCTAATAGTGTTCTACAGAGTTGGGATGCAACCCTTGTTAATCCTTGTACTTGGTTCCATGTGACATGCAACAATGAAAATAGTGTGACTAGAGTTGATCTAGGAAATGCAAATCTATCAGGTCAACTGGTACCACAGCTTGGCCAACTCCAGAAATTGCAGTACTTGGAACTTTATAGTAATAACATAAGCGGAAGAATTCCAAATGAACTGGGAAACTTGACAGAGTTGGTTAGTTTGGATCTTTACCTGAACAACTTAAATGGTCCTATTCCTCCCTCATTGGGCAGGCTTCAGAAGCTACGCTTCCTGAGGCTCAATAATAACAGTTTGAATGAAGGTATTCCCATGTCTCTAACCACCATTGTTGCACTTCAAGTACTTGATCTCTCAAACAACCATTTGACAGGACTAGTTCCAGTCAACGGTTCCTTTTCACTTTTTACTCCTATAAGTTTTGCTAATAATCAGTTGGAAGTTCCTCCAGTTTCTCCACCTCCTCCTCTTCCTCCTACACCCTCATCGTCATCTTCAGTGGGCAACAGCGCAACTGGAGCTATCGCTGGAGGAGTTGCTGCAGGCGCTGCTCTTCTATTTGCAGCTCCTGCAATTTTTCTTGCTTGGTGGCGTCGGAGGAAACCACAAGACCACTTCTTTGATGTTCCTGCTGAGGAGGATCCAGAAGTTCATCTGGGACAACTCAAAAGGTTTTCCTTGCGTGAACTACAAGTTGCGTCGGATAATTTTAGCAACAGAAATATACTCGGTAGAGGTGGATTTGGTAAGGTTTATAAGGGCCGGTTAGCTGATGGCTCTTTAGTTGCAGTGAAAAGACTAAAAGAGGAACGTACTCAAGGTGGAGAGTTACAGTTCCAGACAGAAGTAGAAATGATCAGCATGGCTGTACACCGAAACCTACTTCGTTTACGGGGCTTTTGCATGACACCCACTGAGCGCGTGCTTGTTTATCCTTACATGGAGAATGGAAGTGTTGCATCACGTTTAAGAGAGAGGCCTGAATCAGAGCCCCCACTTGACTGGCCAAAAAGGAAGCGTATTGCACTTGGATCTGCAAGAGGCCTTGCTTACTTGCATGATCATTGTGATCCTAAAATTATTCATCGTGACGTCAAAGCCGCAAATATCTTGTTGGATGAGGAGTTTGAAGCAGTTGTTGGGGATTTTGGGTTAGCTAAACTCATGGACTACAAGGATACTCATGTTACCACTGCTGTACGTGGTACAATTGGGCATATTGCCCCTGAATATTTATCTACTGGTAAATCTTCTGAGAAAACTGATGTCTTTGGCTATGGGGTTATGCTTCTAGAGCTCATAACTGGGCAAAGGGCTTTTGATCTTGCTCGACTTGCGAATGATGATGATGTCATGCTGCTAGATTGGGTGAAGGGACTCCTGAAGGACAAGAAATATGAAACATTAGTTGATGCAGATCTTCAAGGTAATTACAATGAAGAAGAGGTGGAACAACTTATTCAGGTAGCTCTACTTTGCACGCAGAGTACGCCTACGGAACGTCCAAAGATGTCAGAAGTTGTAAGAATGCTTGAAGGTGATGGCCTTGCTGAGAGGTGGGAGGAATGGCAAAAGGAGGAGATGTTCCGGCAAGATTACAACCATGTACACCACCCCCATACTGATTGGATAATAGCTGACTCCACGTCAAATATCCGACCGGATGAGTTGTCAGGGCCAAGATGA\n";

	function example() { 
	    document.getElementById("sequence").value=seq;
	}
	
	function miToggle(element,statusImg,t,poller_to_control) {
		var e = $(element);
		var img = $(statusImg);

		if (e.visible()) {
			e.visualEffect('BlindUp',{duration:t});
			img.src = '/static/images/collapser_plus.png'
			if (poller_to_control){
				poller_to_control.stop();
			}

		} else {
			e.visualEffect('BlindDown',{duration:t});
			img.src = '/static/images/collapser_minus.png'
			if (poller_to_control){
				 poller_to_control.registerCallback();
				 poller_to_control.execute();
			}
		}
	 }
	
</script>

<center>
<div class="section_bar">
	<a href="javascript:miToggle('input_view','tmp_img_input',0.5,null);">
		<img id="tmp_img_input" border="0" src="/static/images/collapser_minus.png"/>
		Run VIGS Tool
	</a>
</div>
</center>

<div id="input_view">
	<br/>
	<center>

	Sequence:<span id="example">(<a onclick="example()">example sequence</a>)</span>
	<br />

	<textarea class="input" id="sequence" name="sequence" cols="62" rows="8"></textarea>
	<br />
	<br />

	<span title="siRNA selected size">n-mer size</span> 
	<input class="input" id="si_rna" type="input" value="21" name="fragment_size" size="2" />&nbsp; &nbsp; &nbsp;

	<span title="Desired VIGS construct length">Fragment length</span> 
	<input class="input" id="f_length" type="input" value="300" name="seq_fragment" size="3" />&nbsp; &nbsp; &nbsp;

	<span title="Number of mismatches allowed in Bowtie alignment">mismatches</span> 
	<input class="input" id="mm" type="input" value="0" name="mismatch" size="1" />
	<br />
	<br />
	Database 
	<select class="input" id='bt2_db' name="database" title="Select plant species to host VIGS experiment">
		<%perl>
		foreach my $d (@databases) { 
			my $db_name = $d;
			$db_name =~ s/_/ /g;

		    print "<option value=\"".$d."\">".$db_name."</option><br />";
		}     
		</%perl>
	</select>
	<br />
	<br />


	<form method="post" enctype="multipart/form-data" encoding="multipart/form-data" id="upload_expression_form" name="upload_expression_form" action="/ajax/upload_expression_file">
	    Upload Expression file: <input type="file" name="expression_file" id="expression_file" encoding="multipart/form-data" title="Insert a expression file in a tab-delimited format"/>
	</form>


	<br />
	<button class="input" id="clear_form" value="clear" title="Clear form">Clear</button>&nbsp; &nbsp; &nbsp;
	<button class="input" id="upload_expression_file" value="Run VIGS Analysis">Run VIGS Analysis</button>

	<br />
	<br />
	</center>

	<center>
	<div class="subsection_bar">
		<a href="javascript:miToggle('usage_view','tmp_img_usage',0.5,null);">
			<img id="tmp_img_usage" border="0" src="/static/images/collapser_plus.png"/>
			VIGS Usage
		</a>
	</div>
	

	<div id="usage_view" class="center_section" style="display:none">
		<p>
			<b>Usage:</b><br />
			1. Paste a <b>sequence</b> like in one of the examples:<br />
			<span style="background-color:#DCDCDC;">&nbsp;&nbsp;>gene_ID<br />&nbsp;&nbsp;ATGGATCAGTCGGTGTTGGCGATCT&nbsp;&nbsp;<br />&nbsp;&nbsp;ACAGCTTGGCCAACTCCAGAAATTG&nbsp;&nbsp;</span><br />
			&nbsp;&nbsp;or<br />
			<span style="background-color:#DCDCDC;">&nbsp;&nbsp;ATGGATCAGTCGGTGTTGGCGATCT&nbsp;&nbsp;</span><br />
			&nbsp;&nbsp;Or paste the <b>gene ID</b>:<br />
			<span style="background-color:#DCDCDC;">&nbsp;&nbsp;Solyc10g047140.1.1&nbsp;&nbsp;</span><br />

			2. Choose <b>n-mer size</b>, nucleotide stretch size in bp, used to identify targeted regions (18-24, Default=21)<br />
			3. Choose <b>Fragment length</b>, desired VIGS fragment length in bp (100-Sequence length, Default=300)<br />
			4. Choose <b>mismatches</b>, number of mismatches allowed in the alignment (0-2, Default=0)<br />
			<!-- 4. Choose <b>mismatches</b>, number of mismatches allowed in the alignment (0-1, Default=0)<br /> -->
			5. Choose <b>database</b><br />
			6. Upload a <b>expression values file</b> (optional), It must be a tab delimited text file, with gene identifiers in the first column and a header in the first row:
			<br/><br/>
		<span style="background-color:#DCDCDC;">
			gene_id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; expr_val p_val ...
			<br/>
			Solyc10g047140.1.1 4.56 0.0001 ...
			<br/>
			Solyc01g000020.1.1 3.64 0.0032 ...
			<br/>
			...
		</span>
		</p>
	</div>
	</center>
</div>
	
<div id="coverage_val" val="0"></div>
<div id="seq_length" val="0"></div>
<div id="best_start" val="0"></div>
<div id="best_end" val="0"></div>
<div id="best_score" val="0"></div>
<div id="db_name" val="0"></div>
<div id="help_fsize" val="0"></div>
<div id="help_nmer" val="0"></div>
<div id="help_mm" val="0"></div>

<div id="img_height" style="display:none;" value="601"></div>

<div id="params" style="display:none;"></div>
<div id="help_dialog_tmp" style="display:none;"></div>

<div id="help_fsize"></div>
<div id="help_nmer"></div>
<div id="help_mm"></div>
<div id="help_db"></div>


<!-- ##################################################################################### -->
<!-- OUTPUT VIEW -->
<!-- ##################################################################################### -->
<br/>
<center>
<div id="res_bar" class="section_bar" style="display:none">
	<a href="javascript:miToggle('results_section','tmp_img_res',0.5,null);">
		<img id="tmp_img_res" border="0" src="/static/images/collapser_minus.png"/>
		Results
	</a>
</div>

<div id="results_section" class="center_section" style="display:none">
	
	<br/>
	<!-- <center> -->
	<div class="subsection_bar">
		<a href="javascript:miToggle('hide1','tmp_img_hide1',0.5,null);">
			<img id="tmp_img_hide1" border="0" src="/static/images/collapser_minus.png"/>
			Modify Parameters
		</a>
	</div>
	
	<div id="hide1" style="display:none;">
		
		<table>
		  <tr>
		    <td id="score_p" style="text-align:'right';"></td>
		  </tr>
		</table>

		<table>
		  <tr>
		    <td>Region Start: </td><td><input type="text" id="cbr_start" size="3"></td>
		    <td>Region End: </td><td><input type="text" id="cbr_end" size="3"> &nbsp;</td>
		    <td><button type="button" id="set_custom" value="set custom best region">Set Custom Region</button><br /></td>
		  </tr>
		  <tr>
		    <td>Target genes: </td><td><input id="t_num" size="1" name="targets" min="1" /></td>
		    <td>Fragment size:</td><td><input id="f_size" size="3" name="seq_fragment" /></td>
		    <td>
		      n-mer: <input id="n_mer" size="2" name="si_rna" />
		      Mismatches: <input id="align_mm" size="1" name="align_mm" />
		    </td>
		    <td><button id="change_par" type="button" value="recalculate">Change</button></td>
		  </tr>
		</table>

		<span id="no_results" style="color:red;"></span>
		<p style="color:red" id="cbr_p"></p>
	</div>
	
	
	<br/>
	<div class="subsection_bar">
		<a href="javascript:miToggle('hide2','tmp_img_hide2',0.5,null);">
			<img id="tmp_img_hide2" border="0" src="/static/images/collapser_minus.png"/>
			Distribution of n-mers
		</a>
	</div>
	

		<div id="hide2" style="display:none;">
		    <div class="seq_map" id="seq_map">
		         <div class="region_square" id="region_square"></div>
		     	 <canvas id="myCanvas" width="700" height="600">
		     	     Your browser does not support the HTML5 canvas
		     	 </canvas>
		    </div>
		    <br />
		    <button id="collapse" value="1">Expand Graph</button>
		    <button id="zoom" value="0">Zoom In</button>
		    <button id="params_dialog">Parameters Used</button>
				<br/>
		</div>

	<br/>
	<div class="subsection_bar">
		<a href="javascript:miToggle('hide3','tmp_img_hide3',0.5,null);">
			<img id="tmp_img_hide3" border="0" src="/static/images/collapser_minus.png"/>
			Predicted Construct
		</a>
	</div>

	<div id="hide3" style="display:none;">
	    <div id="br_seq">
	    	 <p id="best_seq" style="font-family:courier;font-size:16px;"></p>
	    </div>
	</div>

	<br/>

	<div class="subsection_bar">
		<a href="javascript:miToggle('hide4','tmp_img_hide4',0.5,null);">
			<img id="tmp_img_hide4" border="0" src="/static/images/collapser_minus.png"/>
			Sequence Overview
		</a>
	</div>

		<div id="hide4">
			<span id="query" style="display:none"></span>
			<div id="markup" style="align:left;"></div>
		</div>

	<br/>
	<div class="subsection_bar">
		<a href="javascript:miToggle('hide5','tmp_img_hide5',0.5,null);">
			<img id="tmp_img_hide5" border="0" src="/static/images/collapser_minus.png"/>
			Description of matched genes
		</a>
	</div>
	
		<div id="hide5">
			<table id="target_info"></table>

			<div id="desc_dialog">
				<table id="dialog_info"></table>
			</div>
		</div>
	</center>
	
</div>



